$(function(){$.getCookie=function(a){const b=document.cookie,c=b.split(";");for(let b=0;b<c.length;b++){const d=c[b].split("=");if(d[0].replace(/^\s*|\s*$/g,"")===a)return decodeURIComponent(d[1])?d[1]:decodeURIComponent(d[1])}return""},"0"===location.href[location.href.length-1]&&function(){let a=$.getCookie("my_paths");if(""===a||0>=a.length)a=[{src:location.href,open:1}],document.cookie="my_paths="+JSON.stringify(a)+"; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/";else{a=JSON.parse(a);for(let b=0;b<a.length;b++)if(a[b].src===location.href)return a[b].open=parseInt(a[b].open)+1,void(document.cookie="my_paths="+JSON.stringify(a)+"; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/");a.push({src:location.href,open:1}),document.cookie="my_paths="+JSON.stringify(a)+"; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/"}}();let a,b,c,d,e=0;$("img.lazy").lazyload({effect:"fadeIn",threshold:200,skip_invisible:!1}),$(".body").css("height",window.innerHeight-60+"px"),$(window).on("resize",function(){$(".body").css("height",window.innerHeight-60+"px")}),$.resize_img=function(){const e=$("#logo"),f=$("#full_img");f.css("height","auto"),f.css("width","auto"),a=f.width(),b=f.height(),e.css("width","auto"),e.css("width","auto"),c=e.width(),d=e.height(),b>=a?f.css("height",window.innerHeight-60-40-50+"px"):f.css("width",window.innerHeight-60-40-200+"px"),e.css("width",c*(f.width()/a)+"px")},$(".lazy").on("click",function(){const a=event.path[0],b=$("#full_img");b.attr("src",a.src),b.attr("alt",a.alt),$.resize_img()}),$("#my_file").on("change",function(){let a=event.path[0].files;if(0>=a.length)return;a=a[0];let b=a.name;const c=b.lastIndexOf("."),d=b.substring(c,b.length).toUpperCase();if(/(GIF|JPEG|JPG|PNG|ICO)/.test(d)||alert("\u6587\u4EF6\u7C7B\u578B\u4EC5\u9650\u4E8Eico,png,gif,jpeg,jpg\u683C\u5F0F"),5242880<=a.size)return void alert("\u6587\u4EF6\u592A\u5927\uFF0C\u8BF7\u5148\u538B\u7F29");var e=$("#my_file").prop("files"),f=new FormData;f.append("file_logo",e[0]),$.ajax({url:"/upload",type:"POST",data:f,cache:!1,processData:!1,contentType:!1,dataType:"json",success:function(a){a.success?($("#logo").attr("src",a.mess),$(".top").remove(),$("#logo").on("load",function(){$.resize_img()})):alert(a.mess)},error:function(){alert("\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01")}})}),$("#logo").on("mousedown",function(a){function b(){let a=e+(event.x-c),b=f+(event.y-d);$("#logo").css("left",a+"px"),$("#logo").css("top",b+"px")}a.preventDefault();let c=event.x,d=event.y,e=$("#logo").offset().left,f=$("#logo").offset().top;event.path[0].addEventListener("mousemove",b),$("#logo").on("mouseup",function(){event.path[0].removeEventListener("mousemove",b)})}),$("#logo").bind("mousewheel",function(a){const b=$("#logo"),c=b.width()/1e3;let d;if(d=0<a.deltaY||0<a.deltaX?b.width()+a.deltaFactor*c:b.width()-a.deltaFactor*c,!(10>=d||5e3<=d))return $("#logo").css("width",d+"px"),$("#logo").css("height","auto"),!1}),$("#rotationAngle").on("change",function(){let a=$("#rotationAngle").val();e=a,$("#logo").css("transform","rotate(-"+a+"deg)")}),$("#submit").on("click",function(){if(!$("#logo").attr("src"))return void alert("\u8BF7\u9009\u62E9\u6C34\u5370\u6587\u4EF6");const b=$("#full_img").width()/a,c=($("#logo").offset().left-$("#full_img").offset().left)/b,d=($("#logo").offset().top-$("#full_img").offset().top)/b,f={full_image:$("#full_img").attr("src"),logo_image:$("#logo").attr("src"),x:c,y:d,route:e,width:$("#logo").width()/b,height:$("#logo").height()/b};$("#submit").text("\u4E0B\u8F7D\u4E2D\u2026\u2026"),$("#dwn_now").text("\u4E0B\u8F7D\u4E2D\u2026\u2026"),$.ajax({url:"/download_image",type:"post",dataType:"json",headers:{"Content-Type":"application/json;charset=utf-8"},contentType:"application/json; charset=utf-8",data:JSON.stringify(f),success:function(a){var b=new XMLHttpRequest;b.open("GET",a.mess,!0),b.responseType="blob",b.onload=function(){download(b.response,$("#full_img").attr("alt"));for(let b=0;b<$(".lazy").length;b++)$(".lazy")[b].src===$("#full_img").attr("src")&&($(".lazy")[b].src=a.mess);$("#submit").text("\u4E0B\u8F7D"),$("#dwn_now").text("\u76F4\u63A5\u4E0B\u8F7D")},b.send()}})}),$("#dwn_now").on("click",function(){$.dwn($("#full_img").attr("src"),$("#full_img").attr("alt"))}),$("#dwn_all").on("click",function(){}),$.dwn=function(a,b){$("#submit").text("\u4E0B\u8F7D\u4E2D\u2026\u2026"),$("#dwn_now").text("\u4E0B\u8F7D\u4E2D\u2026\u2026");var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(){download(c.response,b),$("#submit").text("\u4E0B\u8F7D"),$("#dwn_now").text("\u76F4\u63A5\u4E0B\u8F7D")},c.send()};try{$(".lazy")[0].addEventListener("load",function(){$(".lazy")[0].click()})}catch(a){}});